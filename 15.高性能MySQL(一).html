<!-- build time:Thu Aug 29 2019 17:20:32 GMT+0800 (GMT+08:00) --><!DOCTYPE html><html class="theme-next mist use-motion" lang="zh-Hans"><head><meta name="generator" content="Hexo 3.9.0"><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="theme-color" content="#222"><script src="/lib/pace/pace.min.js?v=1.0.2"></script><link href="/lib/pace/pace-theme-minimal.min.css?v=1.0.2" rel="stylesheet"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"><link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css"><link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4"><link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222"><meta name="keywords" content="mysql,"><link rel="alternate" href="/atom.xml" title="行川居" type="application/atom+xml"><meta name="description" content="一、逻辑架构1. 连接管理与安全性第一层:大多基于网络客户端/服务器的工具或者服务都有类似的架构，比如连接处理，授权认证，安全等等。第二层：mysql核心功能都在这一层，包括查询解析、分析、优化、缓存以及所有的内置函数。所有的跨存储引擎功能都在这一层实现，比如触发器、存储过程、视图等。第三层：包含存储引擎，负责mysql中的数据的存储和提取。不会解析sql，不同存储引擎也不会相互通信，只是简单的响"><meta name="keywords" content="mysql"><meta property="og:type" content="article"><meta property="og:title" content="15.高性能MySQL(一)"><meta property="og:url" content="http://www.xingchuan.vip/15.高性能MySQL(一).html"><meta property="og:site_name" content="行川居"><meta property="og:description" content="一、逻辑架构1. 连接管理与安全性第一层:大多基于网络客户端/服务器的工具或者服务都有类似的架构，比如连接处理，授权认证，安全等等。第二层：mysql核心功能都在这一层，包括查询解析、分析、优化、缓存以及所有的内置函数。所有的跨存储引擎功能都在这一层实现，比如触发器、存储过程、视图等。第三层：包含存储引擎，负责mysql中的数据的存储和提取。不会解析sql，不同存储引擎也不会相互通信，只是简单的响"><meta property="og:locale" content="zh-Hans"><meta property="og:image" content="https://timgsa.baidu.com/timg?image&quality=80&size=b9999_10000&sec=1564459328961&di=ebd13e527e39953dd5f33f73bfd7df6b&imgtype=0&src=http%3A%2F%2Fwww.manongjc.com%2Fimages%2F51jb%2F1530849075153a0x8m49a075.png"><meta property="og:image" content="https://timgsa.baidu.com/timg?image&quality=80&size=b9999_10000&sec=1564467235392&di=3e5ee36282c1ebfe80e5fb74fe6cd529&imgtype=jpg&src=http%3A%2F%2Fimg3.imgtn.bdimg.com%2Fit%2Fu%3D3830690663%2C1874983557%26fm%3D214%26gp%3D0.jpg"><meta property="og:updated_time" content="2019-08-16T03:07:49.779Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="15.高性能MySQL(一)"><meta name="twitter:description" content="一、逻辑架构1. 连接管理与安全性第一层:大多基于网络客户端/服务器的工具或者服务都有类似的架构，比如连接处理，授权认证，安全等等。第二层：mysql核心功能都在这一层，包括查询解析、分析、优化、缓存以及所有的内置函数。所有的跨存储引擎功能都在这一层实现，比如触发器、存储过程、视图等。第三层：包含存储引擎，负责mysql中的数据的存储和提取。不会解析sql，不同存储引擎也不会相互通信，只是简单的响"><meta name="twitter:image" content="https://timgsa.baidu.com/timg?image&quality=80&size=b9999_10000&sec=1564459328961&di=ebd13e527e39953dd5f33f73bfd7df6b&imgtype=0&src=http%3A%2F%2Fwww.manongjc.com%2Fimages%2F51jb%2F1530849075153a0x8m49a075.png"><script type="text/javascript" id="hexo.configurations">var NexT=window.NexT||{},CONFIG={root:"/",scheme:"Mist",version:"5.1.4",sidebar:{position:"right",display:"post",offset:12,b2t:!0,scrollpercent:!0,onmobile:!1},fancybox:!0,tabs:!0,motion:{enable:!0,async:!0,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},duoshuo:{userId:"0",author:"博主"},algolia:{applicationID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}}}</script><link rel="canonical" href="http://www.xingchuan.vip/15.高性能MySQL(一).html"><title>15.高性能MySQL(一) | 行川居</title></head><body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans"><div class="container sidebar-position-right page-post-detail"><div class="headband"></div><a href="https://github.com/quietAny"><img width="149" height="149" src="https://github.blog/wp-content/uploads/2008/12/forkme_right_darkblue_121621.png?resize=149%2C149" class="attachment-full size-full" alt="Fork me on GitHub" data-recalc-dims="1" style="float:right"></a><header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-wrapper"><div class="site-meta"><div class="custom-logo-site-title"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">行川居</span> <span class="logo-line-after"><i></i></span></a></div><p class="site-subtitle"></p></div><div class="site-nav-toggle"><button><span class="btn-bar"></span> <span class="btn-bar"></span> <span class="btn-bar"></span></button></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i><br>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i><br>关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i><br>标签</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i><br>归档</a></li><li class="menu-item menu-item-guestbook"><a href="/guestbook" rel="section"><i class="menu-item-icon fa fa-fw fa-comment"></i><br>留言板</a></li><li class="menu-item menu-item-search"><a href="javascript:;" class="popup-trigger"><i class="menu-item-icon fa fa-search fa-fw"></i><br>搜索</a></li></ul><div class="site-search"><div class="popup search-popup local-search-popup"><div class="local-search-header clearfix"><span class="search-icon"><i class="fa fa-search"></i> </span><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span><div class="local-search-input-wrapper"><input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input"></div></div><div id="local-search-result"></div></div></div></nav></div></header><main id="main" class="main"><div class="main-inner"><div class="content-wrap"><div id="content" class="content"><div id="posts" class="posts-expand"><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><div class="post-block"><link itemprop="mainEntityOfPage" href="http://www.xingchuan.vip/15.高性能MySQL(一).html"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="川总"><meta itemprop="description" content><meta itemprop="image" content="http://5b0988e595225.cdn.sohucs.com/images/20171030/26ed195281334ba4b1752394b60eb29a.jpeg"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="行川居"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">15.高性能MySQL(一)</h1><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-07-30T23:17:00+08:00">2019-07-30 </time></span><span class="post-category"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-folder-o"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/笔记/" itemprop="url" rel="index"><span itemprop="name">笔记</span> </a></span></span><span class="post-comments-count"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-comment-o"></i> </span><a href="/15.高性能MySQL(一).html#comments" itemprop="discussionUrl"><span class="post-comments-count valine-comment-count" data-xid="/15.高性能MySQL(一).html" itemprop="commentCount"></span> </a></span><span id="/15.高性能MySQL(一).html" class="leancloud_visitors" data-flag-title="15.高性能MySQL(一)"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-eye"></i> </span><span class="post-meta-item-text">阅读次数&#58;</span> <span class="leancloud-visitors-count"></span></span></div></header><div class="post-body" itemprop="articleBody"><h3 id="一、逻辑架构"><a href="#一、逻辑架构" class="headerlink" title="一、逻辑架构"></a>一、逻辑架构</h3><h4 id="1-连接管理与安全性"><a href="#1-连接管理与安全性" class="headerlink" title="1. 连接管理与安全性"></a>1. 连接管理与安全性</h4><p><img src="https://timgsa.baidu.com/timg?image&quality=80&size=b9999_10000&sec=1564459328961&di=ebd13e527e39953dd5f33f73bfd7df6b&imgtype=0&src=http%3A%2F%2Fwww.manongjc.com%2Fimages%2F51jb%2F1530849075153a0x8m49a075.png" alt="架构图"></p><h5 id="第一层"><a href="#第一层" class="headerlink" title="第一层:"></a>第一层:</h5><blockquote><ul><li>大多基于网络客户端/服务器的工具或者服务都有类似的架构，比如连接处理，授权认证，安全等等。</li></ul></blockquote><h5 id="第二层："><a href="#第二层：" class="headerlink" title="第二层："></a>第二层：</h5><blockquote><ul><li>mysql核心功能都在这一层，包括查询解析、分析、优化、缓存以及所有的内置函数。所有的跨存储引擎功能都在这一层实现，比如触发器、存储过程、视图等。</li></ul></blockquote><h5 id="第三层："><a href="#第三层：" class="headerlink" title="第三层："></a>第三层：</h5><blockquote><ul><li>包含存储引擎，负责mysql中的数据的存储和提取。不会解析sql，不同存储引擎也不会相互通信，只是简单的响应上层服务器的请求。</li></ul></blockquote><h4 id="2-优化与执行"><a href="#2-优化与执行" class="headerlink" title="2.优化与执行"></a>2.优化与执行</h4><blockquote><ul><li>每个客户端连接都会在服务器进程中都有一个线程，这个连接的查询只会在这个单独的线程中执行，服务器会缓存线程，不需要新建和销毁。</li></ul></blockquote><h5 id="第一步"><a href="#第一步" class="headerlink" title="第一步:"></a>第一步:</h5><blockquote><ul><li>当客户端连接到服务器时，服务器对其进行认证，基于用户名，密码，原始主机信息，连接成功后，会继续验证该客户端是否有执行某个特定查询的权限。</li></ul></blockquote><h5 id="第二步："><a href="#第二步：" class="headerlink" title="第二步："></a>第二步：</h5><blockquote><ul><li>认证通过后，mysql会解析查询，并创建内部数据结构，对其进行优化，包括重写查询，决定表的读取顺序，以及选择合适的索引。用户可以通过关键字(hint)提示优化器，也可以通过explain请求服务器解释优化过程。</li></ul></blockquote><h5 id="第三步："><a href="#第三步：" class="headerlink" title="第三步："></a>第三步：</h5><blockquote><ul><li>对于select查询，在解析查询之前，服务器会先检查查询缓存，如果能够在其中找到对应的查询，服务器就不必再执行查询解析、优化和执行的整个过程，而是直接返回查询缓存中的结果集。</li></ul></blockquote><hr><h3 id="二、并发控制"><a href="#二、并发控制" class="headerlink" title="二、并发控制"></a>二、并发控制</h3><h4 id="1-读写锁"><a href="#1-读写锁" class="headerlink" title="1.读写锁"></a>1.读写锁</h4><blockquote><ul><li>在处理并发读或者写的时候，可以通过实现一个由两种类型的锁组成的锁系统来解决问题。通常被称为共享锁和排他锁，也叫读锁和写锁。</li></ul></blockquote><h5 id="读锁-共享锁-："><a href="#读锁-共享锁-：" class="headerlink" title="读锁(共享锁)："></a>读锁(共享锁)：</h5><blockquote><ul><li>读锁是共享的，或者说是相互不阻塞的。多个客户在同一时刻可以同时读取同一个资源。而互不干扰。</li></ul></blockquote><h5 id="写锁-排它锁-："><a href="#写锁-排它锁-：" class="headerlink" title="写锁(排它锁)："></a>写锁(排它锁)：</h5><blockquote><ul><li>一个写锁会阻塞其他的写锁和读锁，这个处于安全策略的考虑，只有这样，才能确保在给定的时间里，只有一个用户能执行写入，并防止其他用户读取正在写入的统一资源。</li><li>在实际数据库系统中，锁时时刻刻都在发生，当某个用户正在修改一部分数据时，mysql会通过锁定防止其他用户读取统一数据。</li></ul></blockquote><h4 id="2-锁粒度"><a href="#2-锁粒度" class="headerlink" title="2.锁粒度"></a>2.锁粒度</h4><blockquote><ul><li>提高共享资源并发性的方式就是让锁定对象更有选择性。尽量只锁定需要修改的部分数据，而不是所有的资源。而加锁也需要消耗资源。锁的各种操作，包括获得锁、检查锁是否已经被解除、释放锁都会增加系统开销。</li><li>所谓所策略，就是在锁的开销和数据的安全性之间寻找平衡，一般都是在表上施加行级锁。</li></ul></blockquote><h5 id="表锁："><a href="#表锁：" class="headerlink" title="表锁："></a>表锁：</h5><blockquote><ul><li>最基本的锁策略，并且是开销最小的策略，它会锁住整张表。一个用户在对表进行写操作(插入、删除、更新等)前，需要先获得写锁，这会阻塞其他用户对该表的所有读写操作。只有没有写锁时，其他读取用户才能获取读锁，读锁之间是不相互阻塞的。</li><li>特定场景中，表锁也可能有良好的性能。例如，READ LOCAL表锁支持某些类型的并发操作。另外，写锁也比读锁有更高的优先级，因此一个写锁请求可能会被插入到读锁队列前面，反之不不能。</li></ul></blockquote><h5 id="行级锁："><a href="#行级锁：" class="headerlink" title="行级锁："></a>行级锁：</h5><blockquote><ul><li>可以最大程度地支持并发处理(同时也带来了最大的锁开销)。众所周知，在InnoDB和XtraDB，以及其他的一些存储引擎中实现了行级锁。行级锁只在存储引擎层实现，而mysql服务器层没有实现。</li></ul></blockquote><hr><h3 id="三、事务"><a href="#三、事务" class="headerlink" title="三、事务"></a>三、事务</h3><blockquote><ul><li>事务就是一组原子性的sql操作，或者说一个独立的工作单元。如果数据库引擎能够成功的对数据库应用该组操作的全部语句，那么就执行该组操作，如果其他有任何一条语句因为崩溃或者其他原因无法执行，那么所有语句都不会执行。</li><li>一句话总结：事务内的语句，要么全部执行成功，要么全部执行失败.</li></ul></blockquote><h4 id="1-ACID"><a href="#1-ACID" class="headerlink" title="1.ACID:"></a>1.ACID:</h4><h5 id="原子性-atomicity"><a href="#原子性-atomicity" class="headerlink" title="原子性(atomicity):"></a>原子性(atomicity):</h5><blockquote><ul><li>一个事务必须被视为一个不可分割的最小工作单元，不可能只执行其中的一部分，这就是事务的原子性。</li></ul></blockquote><h5 id="一致性-consistency-："><a href="#一致性-consistency-：" class="headerlink" title="一致性(consistency)："></a>一致性(consistency)：</h5><blockquote><ul><li>数据库总是从一个一致性的状态转换到另外一个一致性的状态，事务中的操作要么全部执行成功，要么全部失败回滚。</li></ul></blockquote><h5 id="隔离性-isolation"><a href="#隔离性-isolation" class="headerlink" title="隔离性(isolation)"></a>隔离性(isolation)</h5><blockquote><ul><li>一个事务所做的修改在最终提交之前，对其他事务是不可见的。</li></ul></blockquote><h5 id="持久性-durability"><a href="#持久性-durability" class="headerlink" title="持久性(durability)"></a>持久性(durability)</h5><blockquote><ul><li>一旦事务提交，对其所做的修改就会永久保存到数据库中。此时即使系统崩溃，修改的数据也不会丢失。</li></ul></blockquote><h4 id="2-隔离级别："><a href="#2-隔离级别：" class="headerlink" title="2.隔离级别："></a>2.隔离级别：</h4><h5 id="READ-UNCOMMITTED-未提交读-："><a href="#READ-UNCOMMITTED-未提交读-：" class="headerlink" title="READ UNCOMMITTED(未提交读)："></a>READ UNCOMMITTED(未提交读)：</h5><blockquote><ul><li>在未提交读级别，事务中的修改，即使没有提交，对其他事务也都是可见的。事务可以读取未提交的数据，这也称为脏读。这个级别会导致很多问题，从性能上来说，不会比其他级别好太多，缺缺乏其他级别的很多好处，一般很少使用。</li></ul></blockquote><h5 id="READ-COMMITTED-提交读-不可重复读"><a href="#READ-COMMITTED-提交读-不可重复读" class="headerlink" title="READ COMMITTED(提交读/不可重复读)"></a>READ COMMITTED(提交读/不可重复读)</h5><blockquote><ul><li>解决了脏读的问题。大多数数据默认的隔离级别，mysql不是。简单定义：一个事务开始时，只能“看见”已经提交的事务所做的修改。换句话说，一个事务从开始直到提交之前，所做的任何修改对其他事务都不可见的。两次执行同样的查询，可能会得到不一样的结果，产生了不可重复读的问题。</li></ul></blockquote><h5 id="REPEATABLE-READ-可重复读-："><a href="#REPEATABLE-READ-可重复读-：" class="headerlink" title="REPEATABLE READ(可重复读)："></a>REPEATABLE READ(可重复读)：</h5><blockquote><ul><li>解决了脏读和不可重复读的问题。mysql的默认隔离级别，该级别保证了再同一事务中多次读取同样记录的结果是一致的。但是无法解决幻读的问题。所谓幻读，指的是当某个事务在读取某个范围内的记录时，另一个事务又会在该范围内插入新的记录，当之前的事务再次读取该范围内的技术时，会产生幻行。InnoDB和XtraDB存储引擎通过多版本并发控制，解决幻读问题。</li></ul></blockquote><h5 id="SERIALIZABLE-可串行化-："><a href="#SERIALIZABLE-可串行化-：" class="headerlink" title="SERIALIZABLE(可串行化)："></a>SERIALIZABLE(可串行化)：</h5><blockquote><ul><li>最高的隔离级别，通过强制事务串行执行，避免了前面说的幻读的问题，会在读取的每一行都加上所，所以可能导致大量的超时和锁争用的问题。实际中很少用到，只有在非常需要确保数据的一致性而且没有并发的情况下，才考虑采用该级别。</li></ul></blockquote><h5 id="总结："><a href="#总结：" class="headerlink" title="总结："></a>总结：</h5><p><img src="https://timgsa.baidu.com/timg?image&quality=80&size=b9999_10000&sec=1564467235392&di=3e5ee36282c1ebfe80e5fb74fe6cd529&imgtype=jpg&src=http%3A%2F%2Fimg3.imgtn.bdimg.com%2Fit%2Fu%3D3830690663%2C1874983557%26fm%3D214%26gp%3D0.jpg" alt></p><h4 id="3-死锁"><a href="#3-死锁" class="headerlink" title="3.死锁"></a>3.死锁</h4><blockquote><ul><li>两个或者多个事务在同一资源上相互占用，并请求锁定对方占用的资源，从而导致恶性循环的现象。当多高事务试图以不同的顺序锁定资源时，就可能产生死锁。多个1事务同事锁定同一个资源时，也会产生死锁。</li></ul></blockquote><h5 id="如何解决死锁？"><a href="#如何解决死锁？" class="headerlink" title="如何解决死锁？"></a>如何解决死锁？</h5><blockquote><ul><li>数据库系统实现了各种死锁检测和死锁超时机制。越复杂的系统，比如InnoDB存储引擎，越能检测出死锁的循环依赖，并立即返回一个错误。这种解决方法很有效。</li><li>另一种解决方式，就是当查询的时候达到锁等待超时的设定后放弃锁请求，这种方法不太好。</li><li>InnoDB目前处理死锁的方法是，将持有最少行级排它锁的事务进行回滚。</li><li>死锁发生后，只有部分或者完全回滚其中的一个事务，才能打破死锁。大多数情况下只需要重新执行因死锁回滚的1事务即可。</li></ul></blockquote><h4 id="4-事务日志"><a href="#4-事务日志" class="headerlink" title="4.事务日志"></a>4.事务日志</h4><blockquote><ul><li>提高事务效率，使用时，存储引擎在修改表的数据时只需要修改其内存拷贝，再把该修改行为记录到持久在硬盘上的事务日志中，而不需要每次都将修改的数据本社持久到磁盘。事务日志采用追加的方式，因此写日志的操作是在磁盘上一小块区域内的顺序I/O，事务日志持久以后，内存中被修改的数据在后台可以慢慢地刷回到磁盘，通常称为预写式日志，修改数据需要写两次磁盘。</li><li>如果日志持久化但是数据没有写回磁盘时，系统奔溃，存储引擎在重启后能够自动恢复这部分被修改的数据。</li></ul></blockquote><h4 id="5-mysql中的事务"><a href="#5-mysql中的事务" class="headerlink" title="5.mysql中的事务"></a>5.mysql中的事务</h4><blockquote><ul><li>提供两种事务型的存储引擎：InnoDB和NDB Cluster。</li><li>默认采用自动提交模式，如果不是显式地开始一个事务，则每个查询都被当做一个事务执行提交操作。</li><li>InnoDB采用的是两阶段锁定协议。在事务执行过程中，随时都可以执行锁定，锁只有在执行COMMIT或者ROLLBACK的时候才会被释放，并且所有的锁是在同一时刻被释放。</li></ul></blockquote><hr><h3 id="四、多版本并发控制-MVCC"><a href="#四、多版本并发控制-MVCC" class="headerlink" title="四、多版本并发控制(MVCC)"></a>四、多版本并发控制(MVCC)</h3><blockquote><ul><li>以InnoDB为主，是通过在每行记录后面保存两个隐藏的列来实现的。这两个列，一个保存了行的创建时间，一个保存行的过期时间(或删除时间)。当然存储的不是实际的时间值，而是系统版本号。每开始一个新的事务，系统版本号会自动递增。事务开始时刻的系统版本号会作为事务的版本号，用来和查询道德每行记录的版本号进行比较。<br>下面看一下，在可重复读的级别下，MVCC具体操作。</li></ul></blockquote><h4 id="1-SELECT"><a href="#1-SELECT" class="headerlink" title="1.SELECT"></a>1.SELECT</h4><blockquote><ul><li>InnoDB会根据以下两个条件检查每行记录：<blockquote><ul><li>a.InnoDB只查找版本早于当前事务版本的数据行(也就是行的系统版本号小于或者等于事务的系统版本号)，这样可以确保事务读取的行，要么是在事务开始前已经存在的，要么是事务自身插入或者修改过得。</li><li>b.行的删除版本要么未定义，要么大于当前事务版本。这样可以确保事务读到的行，在失误开始之前未被删除。</li></ul></blockquote></li><li>只有符合符合上述两个条件的记录，才能返回作为查询结果。</li></ul></blockquote><h4 id="2-INSERT"><a href="#2-INSERT" class="headerlink" title="2.INSERT"></a>2.INSERT</h4><blockquote><ul><li>InnoDB为新插入的每一行保存当前系统版本号作为行版本号。</li></ul></blockquote><h4 id="3-DELETE"><a href="#3-DELETE" class="headerlink" title="3.DELETE"></a>3.DELETE</h4><blockquote><ul><li>InnoDB为删除的的每一行保存当前系统版本号作为行删除标识。</li></ul></blockquote><h4 id="4-UPDATE"><a href="#4-UPDATE" class="headerlink" title="4.UPDATE"></a>4.UPDATE</h4><blockquote><ul><li>InnoDB为插入一行新记录，保存当前系统版本号作为行版本号，同时保存当前系统版本号到原来的行作为行删除标识。、</li></ul></blockquote><h4 id="优缺点："><a href="#优缺点：" class="headerlink" title="优缺点："></a>优缺点：</h4><blockquote><ul><li>保存这两个额外的系统版本号，使大多数读操作都可以不用加锁，操作简单，性能很好，能够保证只会读到符合标准的行。不足在于每个记录都需要额外的存储空间，需要做更多的行检查工作，以及一些额外的维护工作。</li><li>mysql只在可重复读和提交读两个隔离机制下工作。</li></ul></blockquote><hr><h3 id="五、存储引擎"><a href="#五、存储引擎" class="headerlink" title="五、存储引擎"></a>五、存储引擎</h3><h4 id="1-InnoDB"><a href="#1-InnoDB" class="headerlink" title="1.InnoDB"></a>1.InnoDB</h4><blockquote><ul><li>mysql默认的事务型引擎，数据存储在表空间，它是InnoDB管理的黑盒子，由一系列的数据文件组成，可以将每个表的数据和索引存放在单独文件中。</li><li>采用MVCC来支持高并发，并且实现1李四光标准的隔离级别，默认是可重复读，并且可以通过间隙锁策略防止幻读的出现。间隙锁使得InooDB不仅仅锁定查询涉及的行，还会对索引中的间隙进行锁定，防止幻影行的插入。</li><li>表基于聚簇索引建立，对主键查询有很高的性能，不过它的耳机索引中必须包含主键列。所以主键列很大的话，其他索引都会很大。如果表索引较多，主键应当尽可能的小。</li><li>内如做了很多优化，包括从磁盘读取数据时采用的可预测性玉都，能够自动在内存中创建hash索引以加速读操作的自适应哈希索引，以及能够加速插入操作的插入缓冲区。</li></ul></blockquote><h4 id="2-MyISAM"><a href="#2-MyISAM" class="headerlink" title="2.MyISAM"></a>2.MyISAM</h4><blockquote><ul><li>mysql5.1版本以前的默认索引，提供大量特性，包括全文索引、压缩、空间函数，但是不支持事务和行级锁，崩溃后无法安全修复对于只读的数据，或者表比较小、可以忍受修复操作，可以使用MyISAM。</li></ul></blockquote><h5 id="特性："><a href="#特性：" class="headerlink" title="特性："></a>特性：</h5><blockquote><ul><li>加锁与并发<blockquote><ul><li>针对整张表加锁，而不是针对行，读取时会读到所有表加共享锁，写入时则对表加排他。但是在标有读取查询的同时，也可以往表里插入新的数据。</li></ul></blockquote></li><li>修复<blockquote><ul><li>可以收工或者自动执行检查和修复操作，执行表的修复可能导致一些数据丢失，而且修复操作非常慢，可以通过CHECK TABLE mytalbe检查表的错误，如果有错误，可以通过执行REPAIR TABLE mytalbe 进行修复。</li></ul></blockquote></li><li>索引特性<blockquote><ul><li>既是是BLOB和TEXT等长字段，也可以基于前500个字符创建索引，MyISAM也支持全文索引，这是一种基于分词创建的索引，可以支持复杂的查询。</li></ul></blockquote></li><li>延迟更新索引<blockquote><ul><li>创建表时如果指定了DELAY_KEY_WRITE选项，在每次修改执行完成时，不会立刻将修改的索引数据写入磁盘，而是会写到内存中的键缓冲区，只有在清理键缓冲区或者关闭表的时候才会将对应的索引2块写入磁盘，极大的提升写入性能，但是数据库或系统崩溃会造成索引损坏。</li></ul></blockquote></li></ul></blockquote><h4 id="3-mysql内建的其他存储引擎"><a href="#3-mysql内建的其他存储引擎" class="headerlink" title="3.mysql内建的其他存储引擎"></a>3.mysql内建的其他存储引擎</h4><h5 id="Archive引擎"><a href="#Archive引擎" class="headerlink" title="Archive引擎"></a>Archive引擎</h5><blockquote><ul><li>只支持INSERT和SELECT操作。</li></ul></blockquote><h5 id="Blackhole引擎"><a href="#Blackhole引擎" class="headerlink" title="Blackhole引擎"></a>Blackhole引擎</h5><blockquote><ul><li>，没有实现任何的存储机制，它会丢弃索引插入的数据，不做任何保存。</li></ul></blockquote><h5 id="CSV引擎"><a href="#CSV引擎" class="headerlink" title="CSV引擎"></a>CSV引擎</h5><blockquote><ul><li>可以将普通的CSV文件作为mysql的表来处理，但这种表不支持索引。</li></ul></blockquote><h5 id="Federated引擎"><a href="#Federated引擎" class="headerlink" title="Federated引擎"></a>Federated引擎</h5><blockquote><ul><li>方位其他mysql服务器的一个代理，它会创建一个到远程mysql服务器的客户端连接，并将查询传输到远程服务器执行，然后提取或者发送需要的数据。</li></ul></blockquote><h5 id="Memory引擎"><a href="#Memory引擎" class="headerlink" title="Memory引擎"></a>Memory引擎</h5><blockquote><ul><li>如果需要快速地访问数据，并且这些数据不会被修改，重启后丢失也没有关系，则使用Memory表是非常有用的。至少比MyISAM表快一个数量级，因为所有数据数据都保存在内存中，不需要进行磁盘I/O。</li></ul></blockquote><h5 id="Merge引擎"><a href="#Merge引擎" class="headerlink" title="Merge引擎"></a>Merge引擎</h5><blockquote><ul><li>是MyLSAM引擎的变种，由多个MyISAM表合并而来的虚拟表，引入分区后，该引擎已经被放弃。</li></ul></blockquote><h5 id="NDB集群引擎"><a href="#NDB集群引擎" class="headerlink" title="NDB集群引擎"></a>NDB集群引擎</h5><blockquote><ul><li>mysql服务器，NDB集群存储引擎，以及分布式的、share-nothing的、容灾的、高可用的NDB数据库的组合，被称为msql集群。</li></ul></blockquote><h4 id="4-选择合适的存储引擎"><a href="#4-选择合适的存储引擎" class="headerlink" title="4.选择合适的存储引擎"></a>4.选择合适的存储引擎</h4><blockquote><ul><li>大多数情况下，InooDB都是正确的选择，所以在mysql5.5版本后将InnoDB作为默认的存储引擎了，。简单归纳一句话：”除非需要用到某些InnoDB不具备的特性，并没有其他办法代替，否则都应该优先选择InnoDB”。例如用到全文索引，建议优先考虑InnoDB加上Sphinx的组合，而不是支持全文索引的MyISAM。</li></ul></blockquote><h4 id="5-转换表的引擎"><a href="#5-转换表的引擎" class="headerlink" title="5.转换表的引擎"></a>5.转换表的引擎</h4><h5 id="ALTER-TABLE"><a href="#ALTER-TABLE" class="headerlink" title="ALTER TABLE"></a>ALTER TABLE</h5><blockquote><ul><li>将表从一个引擎修改为另一个引擎最简单的方法就是使用ALTER TABLE语句</li></ul></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; ALTER TABLE mytable ENGINE = InnoDB;</span><br></pre></td></tr></table></figure><blockquote><ul><li>需要执行很长时间，原表会加上读锁，会失去和原引擎先关的所有特性。</li></ul></blockquote><h5 id="导出与导入"><a href="#导出与导入" class="headerlink" title="导出与导入"></a>导出与导入</h5><blockquote><ul><li>使用mysqldump工具将数据到处到文件，然后修改文件中CREATE TABLE语句的存储引擎选择，注意同时修改表名。同时要注意mysqldump默认会自动在CREATE TABLE语句前面加上DROP TABLEy语句，不注意这一点可能会导致数据丢失。</li></ul></blockquote><h5 id="创建与查询"><a href="#创建与查询" class="headerlink" title="创建与查询"></a>创建与查询</h5><blockquote><ul><li>综合了第一种和第二张方法，不需要导出整个表数据，而是先创建一个新的存储引擎的表，然后利用INSERT—-SELECT语法来导数据：</li></ul></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt;CREATE TABLE innodb_table  LIKE myisam_table;</span><br><span class="line">mysql&gt;ALTER TABLE innodb_table=InnoDB;</span><br><span class="line">mysql&gt;INSERT INTO innodb_table SELECT * FROM myisam_table;</span><br></pre></td></tr></table></figure><blockquote><ul><li>数据量很大，可以考虑做分批处理，针对每一段时间只需事务提交操作，以避免大事务产生过多的uudo。假设有主键字段id，重复运行以下语句(最小值x和最大值y)将数据导入新表：</li></ul></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; START TRANSACTION;</span><br><span class="line">mysql&gt; INSERT INTO innodb_table SELECT * FROM myisam_table-&gt; WHERE id BETWEEN x AND y;</span><br><span class="line">mysql&gt; COMMIT;</span><br></pre></td></tr></table></figure><blockquote><ul><li>这样操作完成以后，新表是原表的一个全量复制，原表还在，如果需要可以删除原表。如果有必要，可以在执行的过程中对原表加锁，以确保新表和原表的数据一致。</li></ul></blockquote></div><div><div><div style="text-align:center;color:#ccc;font-size:14px">------------本文结束------------</div></div></div><div><div class="my_post_copyright"><script src="//cdn.bootcss.com/clipboard.js/1.5.10/clipboard.min.js"></script><script type="text/javascript" src="http://jslibs.wuxubj.cn/sweetalert_mini/jquery-1.7.1.min.js"></script><script src="http://jslibs.wuxubj.cn/sweetalert_mini/sweetalert.min.js"></script><link rel="stylesheet" type="text/css" href="http://jslibs.wuxubj.cn/sweetalert_mini/sweetalert.mini.css"><p><span>本文标题:</span>15.高性能MySQL(一)</p><p><span>文章作者:</span>川总</p><p><span>发布时间:</span>2019年07月30日 - 23:17:00</p><p><span>最后更新:</span>2019年08月16日 - 11:07:49</p><p><span>原始链接:</span><a href="/15.高性能MySQL(一).html" title="15.高性能MySQL(一)">http://www.xingchuan.vip/15.高性能MySQL(一).html</a> <span class="copy-path" title="点击复制文章链接"><i class="fa fa-clipboard" data-clipboard-text="http://www.xingchuan.vip/15.高性能MySQL(一).html" aria-label="复制成功！"></i></span></p><p><span>许可协议:</span><i class="fa fa-creative-commons"></i> <a rel="license" href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank" title="Attribution-NonCommercial-NoDerivatives 4.0 International (CC BY-NC-ND 4.0)">署名-非商业性使用-禁止演绎 4.0 国际</a> 转载请保留原文链接及作者。</p></div><script>var clipboard=new Clipboard(".fa-clipboard");clipboard.on("success",$(function(){$(".fa-clipboard").click(function(){swal({title:"",text:"复制成功",html:!1,timer:500,showConfirmButton:!1})})}))</script></div><footer class="post-footer"><div class="post-tags"><a href="/tags/mysql/" rel="tag"># mysql</a></div><div class="post-nav"><div class="post-nav-next post-nav-item"><a href="/7.UML类图.html" rel="next" title="7.UML类图"><i class="fa fa-chevron-left"></i> 7.UML类图</a></div><span class="post-nav-divider"></span><div class="post-nav-prev post-nav-item"><a href="/16.高性能MySQL(二).html" rel="prev" title="16.高性能MySQL(二)">16.高性能MySQL(二) <i class="fa fa-chevron-right"></i></a></div></div></footer></div></article><div class="post-spread"><div class="bdsharebuttonbox"><a href="#" class="bds_tsina" data-cmd="tsina" title="分享到新浪微博"></a> <a href="#" class="bds_douban" data-cmd="douban" title="分享到豆瓣网"></a> <a href="#" class="bds_sqq" data-cmd="sqq" title="分享到QQ好友"></a> <a href="#" class="bds_qzone" data-cmd="qzone" title="分享到QQ空间"></a> <a href="#" class="bds_weixin" data-cmd="weixin" title="分享到微信"></a> <a href="#" class="bds_tieba" data-cmd="tieba" title="分享到百度贴吧"></a> <a href="#" class="bds_twi" data-cmd="twi" title="分享到Twitter"></a> <a href="#" class="bds_fbook" data-cmd="fbook" title="分享到Facebook"></a> <a href="#" class="bds_more" data-cmd="more"></a> <a class="bds_count" data-cmd="count"></a></div><script>window._bd_share_config={common:{bdText:"",bdMini:"2",bdMiniList:!1,bdPic:""},share:{bdSize:"16",bdStyle:"0"},image:{viewList:["tsina","douban","sqq","qzone","weixin","twi","fbook"],viewText:"分享到：",viewSize:"16"}}</script><script>with(document)0[(getElementsByTagName("head")[0]||body).appendChild(createElement("script")).src="//bdimg.share.baidu.com/static/api/js/share.js?cdnversion="+~(-new Date/36e5)]</script></div></div></div><div class="comments" id="comments"></div></div><div class="sidebar-toggle"><div class="sidebar-toggle-line-wrap"><span class="sidebar-toggle-line sidebar-toggle-line-first"></span> <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span> <span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id="sidebar" class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">文章目录</li><li class="sidebar-nav-overview" data-target="site-overview-wrap">站点概览</li></ul><section class="site-overview-wrap sidebar-panel"><div class="site-overview"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" src="http://5b0988e595225.cdn.sohucs.com/images/20171030/26ed195281334ba4b1752394b60eb29a.jpeg" alt="川总"><p class="site-author-name" itemprop="name">川总</p><p class="site-description motion-element" itemprop="description">Talk is cheap.<br>Show me your code.</p></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"><a href="/archives/"><span class="site-state-item-count">27</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"><span class="site-state-item-count">3</span> <span class="site-state-item-name">分类</span></div><div class="site-state-item site-state-tags"><a href="/tags/index.html"><span class="site-state-item-count">14</span> <span class="site-state-item-name">标签</span></a></div></nav><div class="feed-link motion-element"><a href="/atom.xml" rel="alternate"><i class="fa fa-rss"></i> RSS</a></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/quietAny" target="_blank" title="GitHub"><i class="fa fa-fw fa-github"></i>GitHub</a> </span><span class="links-of-author-item"><a href="https://me.csdn.net/qq_42926943" target="_blank" title="CSDN"><i class="fa fa-fw fa-copyright"></i>CSDN</a></span></div><div class="links-of-blogroll motion-element links-of-blogroll-block"><div class="links-of-blogroll-title"><i class="fa fa-fw fa-link"></i> 友情链接</div><ul class="links-of-blogroll-list"><li class="links-of-blogroll-item"><a href="http://poohbear.club/" title="Miracle" target="_blank">Miracle</a></li></ul></div></div></section><section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active"><div class="post-toc"><div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#一、逻辑架构"><span class="nav-number">1.</span> <span class="nav-text">一、逻辑架构</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-连接管理与安全性"><span class="nav-number">1.1.</span> <span class="nav-text">1. 连接管理与安全性</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#第一层"><span class="nav-number">1.1.1.</span> <span class="nav-text">第一层:</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#第二层："><span class="nav-number">1.1.2.</span> <span class="nav-text">第二层：</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#第三层："><span class="nav-number">1.1.3.</span> <span class="nav-text">第三层：</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-优化与执行"><span class="nav-number">1.2.</span> <span class="nav-text">2.优化与执行</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#第一步"><span class="nav-number">1.2.1.</span> <span class="nav-text">第一步:</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#第二步："><span class="nav-number">1.2.2.</span> <span class="nav-text">第二步：</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#第三步："><span class="nav-number">1.2.3.</span> <span class="nav-text">第三步：</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#二、并发控制"><span class="nav-number">2.</span> <span class="nav-text">二、并发控制</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-读写锁"><span class="nav-number">2.1.</span> <span class="nav-text">1.读写锁</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#读锁-共享锁-："><span class="nav-number">2.1.1.</span> <span class="nav-text">读锁(共享锁)：</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#写锁-排它锁-："><span class="nav-number">2.1.2.</span> <span class="nav-text">写锁(排它锁)：</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-锁粒度"><span class="nav-number">2.2.</span> <span class="nav-text">2.锁粒度</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#表锁："><span class="nav-number">2.2.1.</span> <span class="nav-text">表锁：</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#行级锁："><span class="nav-number">2.2.2.</span> <span class="nav-text">行级锁：</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#三、事务"><span class="nav-number">3.</span> <span class="nav-text">三、事务</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-ACID"><span class="nav-number">3.1.</span> <span class="nav-text">1.ACID:</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#原子性-atomicity"><span class="nav-number">3.1.1.</span> <span class="nav-text">原子性(atomicity):</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#一致性-consistency-："><span class="nav-number">3.1.2.</span> <span class="nav-text">一致性(consistency)：</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#隔离性-isolation"><span class="nav-number">3.1.3.</span> <span class="nav-text">隔离性(isolation)</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#持久性-durability"><span class="nav-number">3.1.4.</span> <span class="nav-text">持久性(durability)</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-隔离级别："><span class="nav-number">3.2.</span> <span class="nav-text">2.隔离级别：</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#READ-UNCOMMITTED-未提交读-："><span class="nav-number">3.2.1.</span> <span class="nav-text">READ UNCOMMITTED(未提交读)：</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#READ-COMMITTED-提交读-不可重复读"><span class="nav-number">3.2.2.</span> <span class="nav-text">READ COMMITTED(提交读/不可重复读)</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#REPEATABLE-READ-可重复读-："><span class="nav-number">3.2.3.</span> <span class="nav-text">REPEATABLE READ(可重复读)：</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#SERIALIZABLE-可串行化-："><span class="nav-number">3.2.4.</span> <span class="nav-text">SERIALIZABLE(可串行化)：</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#总结："><span class="nav-number">3.2.5.</span> <span class="nav-text">总结：</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-死锁"><span class="nav-number">3.3.</span> <span class="nav-text">3.死锁</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#如何解决死锁？"><span class="nav-number">3.3.1.</span> <span class="nav-text">如何解决死锁？</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-事务日志"><span class="nav-number">3.4.</span> <span class="nav-text">4.事务日志</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-mysql中的事务"><span class="nav-number">3.5.</span> <span class="nav-text">5.mysql中的事务</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#四、多版本并发控制-MVCC"><span class="nav-number">4.</span> <span class="nav-text">四、多版本并发控制(MVCC)</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-SELECT"><span class="nav-number">4.1.</span> <span class="nav-text">1.SELECT</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-INSERT"><span class="nav-number">4.2.</span> <span class="nav-text">2.INSERT</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-DELETE"><span class="nav-number">4.3.</span> <span class="nav-text">3.DELETE</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-UPDATE"><span class="nav-number">4.4.</span> <span class="nav-text">4.UPDATE</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#优缺点："><span class="nav-number">4.5.</span> <span class="nav-text">优缺点：</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#五、存储引擎"><span class="nav-number">5.</span> <span class="nav-text">五、存储引擎</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-InnoDB"><span class="nav-number">5.1.</span> <span class="nav-text">1.InnoDB</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-MyISAM"><span class="nav-number">5.2.</span> <span class="nav-text">2.MyISAM</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#特性："><span class="nav-number">5.2.1.</span> <span class="nav-text">特性：</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-mysql内建的其他存储引擎"><span class="nav-number">5.3.</span> <span class="nav-text">3.mysql内建的其他存储引擎</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#Archive引擎"><span class="nav-number">5.3.1.</span> <span class="nav-text">Archive引擎</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Blackhole引擎"><span class="nav-number">5.3.2.</span> <span class="nav-text">Blackhole引擎</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#CSV引擎"><span class="nav-number">5.3.3.</span> <span class="nav-text">CSV引擎</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Federated引擎"><span class="nav-number">5.3.4.</span> <span class="nav-text">Federated引擎</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Memory引擎"><span class="nav-number">5.3.5.</span> <span class="nav-text">Memory引擎</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Merge引擎"><span class="nav-number">5.3.6.</span> <span class="nav-text">Merge引擎</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#NDB集群引擎"><span class="nav-number">5.3.7.</span> <span class="nav-text">NDB集群引擎</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-选择合适的存储引擎"><span class="nav-number">5.4.</span> <span class="nav-text">4.选择合适的存储引擎</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-转换表的引擎"><span class="nav-number">5.5.</span> <span class="nav-text">5.转换表的引擎</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#ALTER-TABLE"><span class="nav-number">5.5.1.</span> <span class="nav-text">ALTER TABLE</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#导出与导入"><span class="nav-number">5.5.2.</span> <span class="nav-text">导出与导入</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#创建与查询"><span class="nav-number">5.5.3.</span> <span class="nav-text">创建与查询</span></a></li></ol></li></ol></li></ol></div></div></section><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span id="scrollpercent"><span>0</span>%</span></div></div></aside></div></main><footer id="footer" class="footer"><div class="footer-inner"><div class="copyright">&copy; <span itemprop="copyrightYear">2019</span> <span class="with-love"><i class="fa fa-user"></i> </span><span class="author" itemprop="copyrightHolder">川总</span></div><span id="sitetime"></span><script language="javascript">function siteTime(){window.setTimeout("siteTime()",1e3);var e=1e3,t=60*e,o=60*t,i=24*o,a=365*i,n=new Date,r=n.getFullYear(),l=n.getMonth()+1,s=n.getDate(),M=n.getHours(),g=n.getMinutes(),m=n.getSeconds(),T=Date.UTC(2019,6,18,15,0,0),f=Date.UTC(r,l,s,M,g,m),h=f-T,u=Math.floor(h/a),d=Math.floor(h/i-365*u),D=Math.floor((h-(365*u+d)*i)/o),c=Math.floor((h-(365*u+d)*i-D*o)/t),w=Math.floor((h-(365*u+d)*i-D*o-c*t)/e);document.getElementById("sitetime").innerHTML=" 已运行"+d+" 天 "+D+" 小时 "+c+" 分钟 "+w+" 秒"}siteTime()</script><div class="busuanzi-count"><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span class="site-uv">本站访客数 <span class="busuanzi-value" id="busuanzi_value_site_uv"></span> 人次 </span><span class="site-pv">本站总访问量 <span class="busuanzi-value" id="busuanzi_value_site_pv"></span> 次</span></div></div></footer></div><script type="text/javascript">"[object Function]"!==Object.prototype.toString.call(window.Promise)&&(window.Promise=null)</script><script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script><script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script><script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script><script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script><script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script><script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script><script src="/live2d-widget/autoload.js"></script><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><script type="text/javascript">var GUEST = ['nick','mail','link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item=>{
      return GUEST.indexOf(item)>-1;
    });
    new Valine({
        el: '#comments' ,
        verify: false,
        notify: false,
        appId: 'to5fDrBPDdv6UnQXr1iwYrmS-gzGzoHsz',
        appKey: 'oGnbboaGKW9oPhGGcher6ig7',
        placeholder: 'Just go go',
        avatar:'mm',
        guest_info:guest,
        pageSize:'10' || 10,
    });</script><script type="text/javascript">function proceedsearch(){$("body").append('<div class="search-popup-overlay local-search-pop-overlay"></div>').css("overflow","hidden"),$(".search-popup-overlay").click(onPopupClose),$(".popup").toggle();var t=$("#local-search-input");t.attr("autocapitalize","none"),t.attr("autocorrect","off"),t.focus()}var isfetched=!1,isXml=!0,search_path="search.xml";0===search_path.length?search_path="search.xml":/json$/i.test(search_path)&&(isXml=!1);var path="/"+search_path,onPopupClose=function(t){$(".popup").hide(),$("#local-search-input").val(""),$(".search-result-list").remove(),$("#no-result").remove(),$(".local-search-pop-overlay").remove(),$("body").css("overflow","")},searchFunc=function(t,e,o){"use strict";$("body").append('<div class="search-popup-overlay local-search-pop-overlay"><div id="search-loading-icon"><i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i></div></div>').css("overflow","hidden"),$("#search-loading-icon").css("margin","20% auto 0 auto").css("text-align","center"),$.ajax({url:t,dataType:isXml?"xml":"json",async:!0,success:function(t){isfetched=!0,$(".popup").detach().appendTo(".header-inner");var n=isXml?$("entry",t).map(function(){return{title:$("title",this).text(),content:$("content",this).text(),url:$("url",this).text()}}).get():t,r=document.getElementById(e),s=document.getElementById(o),a=function(){var t=r.value.trim().toLowerCase(),e=t.split(/[\s\-]+/);e.length>1&&e.push(t);var o=[];if(t.length>0&&n.forEach(function(n){function r(e,o,n,r){for(var s=r[r.length-1],a=s.position,i=s.word,l=[],h=0;a+i.length<=n&&0!=r.length;){i===t&&h++,l.push({position:a,length:i.length});var p=a+i.length;for(r.pop();0!=r.length&&(s=r[r.length-1],a=s.position,i=s.word,p>a);)r.pop()}return c+=h,{hits:l,start:o,end:n,searchTextCount:h}}function s(t,e){var o="",n=e.start;return e.hits.forEach(function(e){o+=t.substring(n,e.position);var r=e.position+e.length;o+='<b class="search-keyword">'+t.substring(e.position,r)+"</b>",n=r}),o+=t.substring(n,e.end)}var a=!1,i=0,c=0,l=n.title.trim(),h=l.toLowerCase(),p=n.content.trim().replace(/<[^>]+>/g,""),u=p.toLowerCase(),f=decodeURIComponent(n.url),d=[],g=[];if(""!=l&&(e.forEach(function(t){function e(t,e,o){var n=t.length;if(0===n)return[];var r=0,s=[],a=[];for(o||(e=e.toLowerCase(),t=t.toLowerCase());(s=e.indexOf(t,r))>-1;)a.push({position:s,word:t}),r=s+n;return a}d=d.concat(e(t,h,!1)),g=g.concat(e(t,u,!1))}),(d.length>0||g.length>0)&&(a=!0,i=d.length+g.length)),a){[d,g].forEach(function(t){t.sort(function(t,e){return e.position!==t.position?e.position-t.position:t.word.length-e.word.length})});var v=[];0!=d.length&&v.push(r(l,0,l.length,d));for(var $=[];0!=g.length;){var C=g[g.length-1],m=C.position,x=C.word,w=m-20,y=m+80;0>w&&(w=0),y<m+x.length&&(y=m+x.length),y>p.length&&(y=p.length),$.push(r(p,w,y,g))}$.sort(function(t,e){return t.searchTextCount!==e.searchTextCount?e.searchTextCount-t.searchTextCount:t.hits.length!==e.hits.length?e.hits.length-t.hits.length:t.start-e.start});var T=parseInt("1");T>=0&&($=$.slice(0,T));var b="";b+=0!=v.length?"<li><a href='"+f+"' class='search-result-title'>"+s(l,v[0])+"</a>":"<li><a href='"+f+"' class='search-result-title'>"+l+"</a>",$.forEach(function(t){b+="<a href='"+f+'\'><p class="search-result">'+s(p,t)+"...</p></a>"}),b+="</li>",o.push({item:b,searchTextCount:c,hitCount:i,id:o.length})}}),1===e.length&&""===e[0])s.innerHTML='<div id="no-result"><i class="fa fa-search fa-5x" /></div>';else if(0===o.length)s.innerHTML='<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>';else{o.sort(function(t,e){return t.searchTextCount!==e.searchTextCount?e.searchTextCount-t.searchTextCount:t.hitCount!==e.hitCount?e.hitCount-t.hitCount:e.id-t.id});var a='<ul class="search-result-list">';o.forEach(function(t){a+=t.item}),a+="</ul>",s.innerHTML=a}};r.addEventListener("input",a),$(".local-search-pop-overlay").remove(),$("body").css("overflow",""),proceedsearch()}})};$(".popup-trigger").click(function(t){t.stopPropagation(),isfetched===!1?searchFunc(path,"local-search-input","local-search-result"):proceedsearch()}),$(".popup-btn-close").click(onPopupClose),$(".popup").click(function(t){t.stopPropagation()}),$(document).on("keyup",function(t){var e=27===t.which&&$(".search-popup").is(":visible");e&&onPopupClose()})</script><script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.4.js"></script><script>AV.initialize("to5fDrBPDdv6UnQXr1iwYrmS-gzGzoHsz","oGnbboaGKW9oPhGGcher6ig7")</script><script>function showTime(e){var t=new AV.Query(e),n=[],o=$(".leancloud_visitors");o.each(function(){n.push($(this).attr("id").trim())}),t.containedIn("url",n),t.find().done(function(e){var t=".leancloud-visitors-count";if(0===e.length)return void o.find(t).text(0);for(var i=0;i<e.length;i++){var r=e[i],s=r.get("url"),l=r.get("time"),c=document.getElementById(s);$(c).find(t).text(l)}for(var i=0;i<n.length;i++){var s=n[i],c=document.getElementById(s),u=$(c).find(t);""==u.text()&&u.text(0)}}).fail(function(e,t){console.log("Error: "+t.code+" "+t.message)})}function addCount(e){var t=$(".leancloud_visitors"),n=t.attr("id").trim(),o=t.attr("data-flag-title").trim(),i=new AV.Query(e);i.equalTo("url",n),i.find({success:function(t){if(t.length>0){var i=t[0];i.fetchWhenSave(!0),i.increment("time"),i.save(null,{success:function(e){var t=$(document.getElementById(n));t.find(".leancloud-visitors-count").text(e.get("time"))},error:function(e,t){console.log("Failed to save Visitor num, with error message: "+t.message)}})}else{var r=new e,s=new AV.ACL;s.setPublicReadAccess(!0),s.setPublicWriteAccess(!0),r.setACL(s),r.set("title",o),r.set("url",n),r.set("time",1),r.save(null,{success:function(e){var t=$(document.getElementById(n));t.find(".leancloud-visitors-count").text(e.get("time"))},error:function(e,t){console.log("Failed to create")}})}},error:function(e){console.log("Error:"+e.code+" "+e.message)}})}$(function(){var e=AV.Object.extend("Counter");1==$(".leancloud_visitors").length?addCount(e):$(".post-title-link").length>1&&showTime(e)})</script><script type="text/javascript" src="/js/src/love.js"></script></body></html><!-- rebuild by neat -->